function startTime(){var n=new Date,t=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),r=n.getSeconds().toString().padStart(2,"0"),u;$(".clock").html(t+":"+i+"<span class='sec'>"+r+"<\/span>");u=setTimeout(startTime,500)}function startMainLoop(){MainLoop()}function MainLoop(){calendarUpdateCounter--;calendarUpdateCounter<=0&&(console.log("update calendar"),updateCalendar(),calendarUpdateCounter=300);imageUpdateCounter--;imageUpdateCounter<=0&&(console.log("update image"),updateImage(),imageUpdateCounter=90);putStatus(`next image update ${imageUpdateCounter}s - next calendar update ${calendarUpdateCounter}s`);var n=setTimeout(MainLoop,1e3)}function putMessage(n){$("#message").html(n)}function putStatus(n){$("#status").html(n)}function updateCalendar(){monthNames&&weekDayNames||$.ajax({type:"get",url:"/api/calendar/dateformatinfo",context:document.body,success:function(n){n&&(monthNames=n.monthNames,weekDayNames=n.weekDayNames)}});$.ajax({type:"get",url:"/api/calendar",context:document.body,success:function(n){n&&renderCalendar(n)}})}function ISO8601_week_no(n){var t=new Date(n.valueOf()),r=(n.getDay()+6)%7,i;return t.setDate(t.getDate()-r+3),i=t.valueOf(),t.setMonth(0,1),t.getDay()!==4&&t.setMonth(0,1+(11-t.getDay())%7),1+Math.ceil((i-t)/6048e5)}function ISO8601_date(n){return n.getFullYear().toString()+"-"+(n.getMonth()+1).toString().padStart(2,"0")+"-"+n.getDate().toString().padStart(2,"0")}function addDays(n,t){var i=new Date(n);return i.setDate(i.getDate()+t),i}function currentDate(){let n=new Date;return n.setHours(0,0,0,0),n}function renderCalendar(n){putMessage("calendar refresh");let r=currentDate(),t=r.getDay(),i=currentDate();for(t===0&&(i=addDays(i,-1),t=i.getDay());t>1;)i=addDays(i,-1),t=i.getDay();let u=currentDate();for($("#calendar").empty(),w=0;w<3;w++)for(t=0;t<7;t++){let e=w*7+t,u=addDays(i,e),a=ISO8601_date(u)===ISO8601_date(r);if(t===0){let n=$("<div/>"),t="<br/><span class='weekofyear'>"+ISO8601_week_no(u).toString().padStart(2,"0")+"<\/span>";n.addClass("week_title").html(t);$("#calendar").append(n)}let o=$("<div/>"),s="day"+e,h="dayContent"+e;o.attr("id",s).addClass("day");let c="";(e===0||u.getDate()==1)&&(c=monthNames[u.getMonth()]);let v="<span class='monthofyear'>"+c+"<\/span><br/><span class='dayofweek'>"+weekDayNames[t]+"<\/span>&nbsp;<span class='dayofmonth'>"+u.getDate().toString().padStart(2,"0")+"<\/span>";o.html("<div class='dayHeader'><div class='day_title'>"+v+"<\/div><\/div><div id='"+h+"' class='dayContent'><\/div>");o.removeClass("today").removeClass("monthfirst").addClass("day");$("#calendar").append(o);let f="",l=ISO8601_date(u);n.forEach(n=>{if(l===n.date&&n.allDayEvent)if(n.publicHoliday)f+="<div class='public_holiday_day'>"+n.description+"<\/div>";else if(n.schoolHoliday)f+="<div class='school_holiday_day'>"+n.description+"<\/div>";else{let t=(n.isPrimary?" primary_calendar":"")+(n.isSecondary?" secondary_calendar":"");f+="<div class='all_day"+t+"'>"+n.description+"<\/div>"}});n.forEach(n=>{if(l===n.date&&!n.allDayEvent){let t=(n.isPrimary?" primary_calendar":"")+(n.isSecondary?" secondary_calendar":"");f+="<p class='single_event"+t+"'>"+n.time+" "+n.description+"<\/p>"}});$("#"+s+" > #"+h).html(f);a&&$("#"+s).toggleClass("today")}putMessage("")}function updateImage(){$.ajax({type:"get",url:"/api/image",context:document.body,success:function(n){renderImage(n)}})}function renderImage(n){putMessage("updating image");$("<img/>").attr("src",n.src).on("load",function(){$(this).remove();$(".imageContainer").css({background:"#000 url("+n.src+") center center",backgroundSize:"cover",backgroundRepeat:"no-repeat"});var t="";n.month&&n.year&&(t=monthNames[n.month-1]+" "+n.year);$(".imageCreated").html(t)});putMessage("")}var calendarUpdateCounter=1,imageUpdateCounter=1;let monthNames,weekDayNames;