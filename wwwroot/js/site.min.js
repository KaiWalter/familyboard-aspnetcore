function startTime(){var n=new Date,t=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),r=n.getSeconds().toString().padStart(2,"0"),u;$(".clock").html(t+":"+i+"<span class='sec'>"+r+"<\/span>");u=setTimeout(startTime,500)}function startMainLoop(){MainLoop()}function MainLoop(){calendarUpdateCounter--;calendarUpdateCounter<=0&&(console.log("update calendar"),updateCalendar(),calendarUpdateCounter=300);imageUpdateCounter--;imageUpdateCounter<=0&&(console.log("update image"),updateImage(),imageUpdateCounter=90);putStatus(`next image update ${imageUpdateCounter}s - next calendar update ${calendarUpdateCounter}s`);var n=setTimeout(MainLoop,1e3)}function putMessage(n){$("#message").html(n)}function putStatus(n){$("#status").html(n)}function initCalendar(){monthNames&&weekDayNames||$.ajax({type:"get",url:"/api/calendar/dateformatinfo",context:document.body,success:function(n){n&&(monthNames=n.monthNames,weekDayNames=n.weekDayNames)}})}function updateCalendar(){initCalendar();$.ajax({type:"get",url:"/api/calendar",context:document.body,success:function(n){n&&renderCalendar(n)}})}function ISO8601_week_no(n){var t=new Date(n.valueOf()),r=(n.getDay()+6)%7,i;return t.setDate(t.getDate()-r+3),i=t.valueOf(),t.setMonth(0,1),t.getDay()!==4&&t.setMonth(0,1+(11-t.getDay())%7),1+Math.ceil((i-t)/6048e5)}function ISO8601_date(n){return n.getFullYear().toString()+"-"+(n.getMonth()+1).toString().padStart(2,"0")+"-"+n.getDate().toString().padStart(2,"0")}function addDays(n,t){var i=new Date(n);return i.setDate(i.getDate()+t),i}function currentDate(){let n=new Date;return n.setHours(0,0,0,0),n}function renderCalendar(n){putMessage("calendar refresh");let r=currentDate(),t=r.getDay(),i=currentDate();for(t===0&&(i=addDays(i,-1),t=i.getDay());t>1;)i=addDays(i,-1),t=i.getDay();let f=currentDate();$("#calendar").empty();let u=[];for(w=0;w<3;w++){let e=addDays(i,w*7),f={weekNo:ISO8601_week_no(e).toString().padStart(2,"0"),days:[]};for(t=0;t<7;t++){let o=w*7+t,u=addDays(i,o),y=ISO8601_date(u)===ISO8601_date(r);if(t===0){let n=$("<div/>"),t="<br/><span class='weekofyear'>"+ISO8601_week_no(u).toString().padStart(2,"0")+"<\/span>";n.addClass("week_title").html(t);$("#calendar").append(n)}let s=$("<div/>"),h="day"+o,a="dayContent"+o;s.attr("id",h).addClass("day");let c="";(o===0||u.getDate()==1)&&(c=monthNames[u.getMonth()]);let p="<span class='monthofyear'>"+c+"<\/span><br/><span class='dayofweek'>"+weekDayNames[t]+"<\/span>&nbsp;<span class='dayofmonth'>"+u.getDate().toString().padStart(2,"0")+"<\/span>",l={monthOfYear:c,dayOfWeek:weekDayNames[t],dayOfMonth:u.getDate().toString().padStart(2,"0"),events:[]};s.html("<div class='dayHeader'><div class='day_title'>"+p+"<\/div><\/div><div id='"+a+"' class='dayContent'><\/div>");s.removeClass("today").removeClass("monthfirst").addClass("day");$("#calendar").append(s);let e="",v=ISO8601_date(u);n.forEach(n=>{if(v===n.date&&n.allDayEvent){if(n.publicHoliday)e+="<div class='public_holiday_day'>"+n.description+"<\/div>";else if(n.schoolHoliday)e+="<div class='school_holiday_day'>"+n.description+"<\/div>";else{let t=(n.isPrimary?" primary_calendar":"")+(n.isSecondary?" secondary_calendar":"");e+="<div class='all_day"+t+"'>"+n.description+"<\/div>"}let t={description:n.description,isPrimary:n.isPrimary,isSecondary:n.isSecondary,allDayEvent:n.allDayEvent,publicHoliday:n.publicHoliday,schoolHoliday:n.schoolHoliday};l.events.push(t)}});n.forEach(n=>{if(v===n.date&&!n.allDayEvent){let t=(n.isPrimary?" primary_calendar":"")+(n.isSecondary?" secondary_calendar":"");e+="<p class='single_event"+t+"'>"+n.time+" "+n.description+"<\/p>";let i={description:n.description,time:n.time,isPrimary:n.isPrimary,isSecondary:n.isSecondary,allDayEvent:n.allDayEvent,publicHoliday:n.publicHoliday,schoolHoliday:n.schoolHoliday};l.events.push(i)}});$("#"+h+" > #"+a).html(e);y&&$("#"+h).toggleClass("today");f.days.push(l)}u.push(f)}console.log(JSON.stringify(u));putMessage("")}function updateImage(){$.ajax({type:"get",url:"/api/image",context:document.body,success:function(n){renderImage(n)}})}function renderImage(n){putMessage("updating image");$("<img/>").attr("src",n.src).on("load",function(){$(this).remove();$(".imageContainer").css({background:"#000 url("+n.src+") center center",backgroundSize:"cover",backgroundRepeat:"no-repeat"});var t="";n.month&&n.year&&(t=monthNames[n.month-1]+" "+n.year);$(".imageCreated").html(t)});putMessage("")}var calendarUpdateCounter=1,imageUpdateCounter=1;let monthNames,weekDayNames;